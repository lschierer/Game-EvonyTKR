% layout 'default';
% title 'General Details: ' . $item->name;

<link rel="stylesheet" href="/css/collectionDetails.css" />
<% use Scalar::Util qw(reftype); %>
<div class="general-details">
  <% if( $item && reftype $item eq 'OBJECT' && $item->isa('Game::EvonyTKR::Model::General')) { %>
    <h2 class="spectrum-Heading spectrum-Heading--sizeXL">Details for <%= $item->name %></h2>
    <div class="basicInfo">
      <div class="baseStats">
        <h3 class="spectrum-Heading spectrum-Heading--sizeL">Basic Attributes</h3>
        <table class="spectrum-Table spectrum-Table--sizeM spectrum-Table--quiet">
          <thead class="spectrum-Table-head">
            <tr>
              <th class="spectrum-Table-headCell">Attribute</th>
              <th class="spectrum-Table-headCell">Base</th>
              <th class="spectrum-Table-headCell">Increment</th>
            </tr>
          </thead>
          <tbody class="spectrum-Table-body">
            <tr class="spectrum-Table-row">
              <td class="spectrum-Table-cell"><strong class="spectrum-Body-strong">Attack</strong></td>
              <td class="spectrum-Table-cell"><%= $item->basicAttributes->attack->base %></td>
              <td class="spectrum-Table-cell"><%= $item->basicAttributes->attack->increment %></td>
            </tr>
            <tr class="spectrum-Table-row">
              <td class="spectrum-Table-cell"><strong class="spectrum-Body-strong">Defense</strong></td>
              <td class="spectrum-Table-cell"><%= $item->basicAttributes->defense->base %></td>
              <td class="spectrum-Table-cell"><%= $item->basicAttributes->defense->increment %></td>
            </tr>
            <tr class="spectrum-Table-row">
              <td class="spectrum-Table-cell"><strong class="spectrum-Body-strong">Leadership</strong></td>
              <td class="spectrum-Table-cell"><%= $item->basicAttributes->leadership->base %></td>
              <td class="spectrum-Table-cell"><%= $item->basicAttributes->leadership->increment %></td>
            </tr>
            <tr class="spectrum-Table-row">
              <td class="spectrum-Table-cell"><strong class="spectrum-Body-strong">Politics</strong></td>
              <td class="spectrum-Table-cell"><%= $item->basicAttributes->politics->base %></td>
              <td class="spectrum-Table-cell"><%= $item->basicAttributes->politics->increment %></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="ExtraBaseInfo">
        <h3 class="spectrum-Heading spectrum-Heading--sizeL">
           Basic Information
        </h3>
        <ul class="baseInfo">
          <li class="spectrum-Body spectrum-Body--sizeS">
            <strong class="spectrum-Body-strong">Type: </strong>
            <% if (ref $item->type eq 'ARRAY') { %>
              <% my $lastIndex = $#{$item->type}; %>
              <% for my $i (0..$lastIndex) { %>
                <% my $type = $item->type->[$i]; %>
                <% my $formattedType = $type =~ s/_/ /gr; %>
                <% $formattedType =~ s/(\w)(\w+)( specialist)?/\U$1\L$2 \US\Lpecialist/; %>
                <%= $formattedType %><%= $i == $lastIndex ? '' : ', ' %>
              <% } %>
            <% } else { %>
              <% my $formattedType = $item->type =~ s/_/ /gr; %>
              <% $formattedType =~ s/(\w)(\w+)( specialist)?/\U$1\L$2 \US\Lpecialist/; %>
              <%= $formattedType %>
            <% } %>
          </li>
          <li class="spectrum-Body spectrum-Body--sizeS">
            <strong class="spectrum-Body-strong">Ascendable: </strong>
            <span class="ascending-value"><%= $item->ascending ? "True" : "False" %></span>
          </li>
        </ul>
      </div>
    </div>
    <div class="specialskill">
      <h3 class="spectrum-Heading spectrum-Heading--sizeL">
        <%= $item->name %>'s Special Skill
      </h3>
      <h4 class="spectrum-Heading spectrum-Heading--sizeM">
        <%= $item->builtInBookName %>
      </h4>
      <%= get_builtin_book_text($item->builtInBookName) %>
      <% if($item->ascending) { %>
        <h4 class="spectrum-Heading spectrum-Heading--sizeM">
          <%= $item->name %>'s Ascension Buffs
        </h4>
        <%= get_ascending_section($item->name) %>
      <% } %>
    </div>
    <div class="specialties">
      <h3 class="spectrum-Heading spectrum-Heading--sizeL">
        <%= $item->name %>'s Specialties
      </h3>
      <ol>
        <% foreach my $specialtyName ( @{ $item->specialtyNames } ) { %>
          <li class="spectrum-Body spectrum-Body--sizeS">
            <a href="/Reference/Specialties/<%= $specialtyName %>" class="spectrum-Link spectrum-Link--quiet spectrum-Link--primary">
              <%= $specialtyName %>
            </a>
          </li>
        <% } %>
      </ol>
    </div>
  <% } else { %>
    <!-- <%= Scalar::Util::reftype $item; %> -->
    <!-- <%= $item->isa('Game::EvonyTKR::General'); %> -->
  <% } %>

  % if (stash 'buff-summaries') {
    <div class="buff-summaries">
      <h2 class="spectrum-Heading spectrum-Heading--sizeL">Buff Summaries</h2>

      <h3 class="spectrum-Heading spectrum-Heading--sizeM">Summary Values (Based on General's Primary Type)</h3>
      <table class="spectrum-Table spectrum-Table--sizeM spectrum-Table--quiet">
        <thead class="spectrum-Table-head">
          <tr>
            <th class="spectrum-Table-headCell">Buff Type</th>
            <th class="spectrum-Table-headCell">Value</th>
          </tr>
        </thead>
        <tbody class="spectrum-Table-body">
          <tr class="spectrum-Table-row">
            <td class="spectrum-Table-cell"><strong class="spectrum-Body-strong">March Size</strong></td>
            <td class="spectrum-Table-cell"><%= stash('buff-summaries')->{marchIncrease} %></td>
          </tr>
          <tr class="spectrum-Table-row">
            <td class="spectrum-Table-cell"><strong class="spectrum-Body-strong">Attack</strong></td>
            <td class="spectrum-Table-cell"><%= stash('buff-summaries')->{attackIncrease} %></td>
          </tr>
          <tr class="spectrum-Table-row">
            <td class="spectrum-Table-cell"><strong class="spectrum-Body-strong">Defense</strong></td>
            <td class="spectrum-Table-cell"><%= stash('buff-summaries')->{defenseIncrease} %></td>
          </tr>
          <tr class="spectrum-Table-row">
            <td class="spectrum-Table-cell"><strong class="spectrum-Body-strong">HP</strong></td>
            <td class="spectrum-Table-cell"><%= stash('buff-summaries')->{hpIncrease} %></td>
          </tr>
        </tbody>
      </table>

      <h3 class="spectrum-Heading spectrum-Heading--sizeM">Buff Values by Troop Type</h3>
      % my $buffValues = stash('buff-summaries')->{buffValues};
      % my @buffAttributes = ();
      % if (keys %$buffValues) {
      %   my $firstTroopType = (sort keys %$buffValues)[0];
      %   @buffAttributes = sort keys %{$buffValues->{$firstTroopType}};
      % }
      <table class="spectrum-Table spectrum-Table--sizeM spectrum-Table--quiet">
        <thead class="spectrum-Table-head">
          <tr>
            <th class="spectrum-Table-headCell">Troop Type</th>
            % foreach my $attr (@buffAttributes) {
              <th class="spectrum-Table-headCell"><%= $attr eq 'March Size Capacity' ? 'March Size' : $attr %></th>
            % }
          </tr>
        </thead>
        <tbody class="spectrum-Table-body">
          % foreach my $troopType (sort keys %$buffValues) {
            <tr class="spectrum-Table-row">
              <td class="spectrum-Table-cell"><strong><%= $troopType %></strong></td>
              % foreach my $attr (@buffAttributes) {
                <td class="spectrum-Table-cell"><%= $buffValues->{$troopType}->{$attr} // 0 %></td>
              % }
            </tr>
          % }
        </tbody>
      </table>

      <h3 class="spectrum-Heading spectrum-Heading--sizeM">Debuff Values by Troop Type</h3>
      % my $debuffValues = stash('buff-summaries')->{debuffValues};
      % my @debuffAttributes = ();
      % if (keys %$debuffValues) {
      %   my $firstTroopType = (sort keys %$debuffValues)[0];
      %   @debuffAttributes = sort keys %{$debuffValues->{$firstTroopType}};
      % }
      <table class="spectrum-Table spectrum-Table--sizeM spectrum-Table--quiet">
        <thead class="spectrum-Table-head">
          <tr>
            <th class="spectrum-Table-headCell">Troop Type</th>
            % foreach my $attr (@debuffAttributes) {
              <th class="spectrum-Table-headCell"><%= $attr %></th>
            % }
          </tr>
        </thead>
        <tbody class="spectrum-Table-body">
          % foreach my $troopType (sort keys %$debuffValues) {
            <tr class="spectrum-Table-row">
              <td class="spectrum-Table-cell"><strong><%= $troopType %></strong></td>
              % foreach my $attr (@debuffAttributes) {
                <td class="spectrum-Table-cell"><%= $debuffValues->{$troopType}->{$attr} // 0 %></td>
              % }
            </tr>
          % }
        </tbody>
      </table>
        </tbody>
      </table>

    </div>
  % }
</div>
