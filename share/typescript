Script started on Mon Jun 16 17:43:52 2025
c
The default interactive shell is now zsh.
To update your account to use zsh, please run `chsh -s /bin/zsh`.
For more details, please visit https://support.apple.com/kb/HT208050.
]697;OSCUnlock=f0b407a1d40d4101ba696cdb2b1ae760]697;Dir=/Users/lschiere/src/schierer/Game-EvonyTKR/share]697;Shell=bash]697;ShellPath=/bin/bash]697;PID=19401]697;ExitCode=0]697;TTY=/dev/ttys018]697;Log=]697;User=lschiere]697;OSCLock=f0b407a1d40d4101ba696cdb2b1ae760]697;PreExec]697;OSCLock=f0b407a1d40d4101ba696cdb2b1ae760]697;PreExec[?1034h]697;StartPrompt]0;lschiere@80a997121f31: ~/src/schierer/Game-EvonyTKR/sharelschiere@80a997121f31:~/src/schierer/Game-EvonyTKR/share$ ]697;EndPrompt]697;NewCmd=f0b407a1d40d4101ba696cdb2b1ae760cat tsconfig.json 
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "@tsconfig/node22/tsconfig.json",
  "compilerOptions": {
    "esModuleInterop": true,
    "lib": ["ES2023", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "noImplicitReturns": true,
    "noUnusedLocals": true,
    "resolveJsonModule": true,
    "strict": true,
    "target": "ES2023",
    "verbatimModuleSyntax": true,
    "types": ["node"],
    "noEmit": true,
    "composite": true,
    "rootDir": ".",
    "baseUrl": "./",
    "outDir": "./public/js"
  },
  "exclude": ["**/node_modules/**"],
  "include": ["./ts/**/*.ts", "./types/*.d.ts"]
}
]697;OSCUnlock=f0b407a1d40d4101ba696cdb2b1ae760]697;Dir=/Users/lschiere/src/schierer/Game-EvonyTKR/share]697;Shell=bash]697;ShellPath=/bin/bash]697;PID=19401]697;ExitCode=0]697;TTY=/dev/ttys018]697;Log=]697;User=lschiere]697;StartPrompt]0;lschiere@80a997121f31: ~/src/schierer/Game-EvonyTKR/sharelschiere@80a997121f31:~/src/schierer/Game-EvonyTKR/share$ ]697;EndPrompt]697;NewCmd=f0b407a1d40d4101ba696cdb2b1ae760cat tsconfig.build.json 
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "noEmit": false,
    "declaration": true,
    "declarationMap": true,
    "emitDeclarationOnly": false,
    "composite": true
  }
}
]697;OSCUnlock=f0b407a1d40d4101ba696cdb2b1ae760]697;Dir=/Users/lschiere/src/schierer/Game-EvonyTKR/share]697;Shell=bash]697;ShellPath=/bin/bash]697;PID=19401]697;ExitCode=0]697;TTY=/dev/ttys018]697;Log=]697;User=lschiere]697;OSCLock=f0b407a1d40d4101ba696cdb2b1ae760]697;PreExec]697;StartPrompt]0;lschiere@80a997121f31: ~/src/schierer/Game-EvonyTKR/sharelschiere@80a997121f31:~/src/schierer/Game-EvonyTKR/share$ ]697;EndPrompt]697;NewCmd=f0b407a1d40d4101ba696cdb2b1ae760cat scripts/build-ts.ts 
import { build } from 'esbuild';
import { glob } from 'glob';
import { fileURLToPath } from 'url';
import { dirname } from 'path';
import fs from 'fs';
import { execSync } from 'child_process';
import path from 'path';
import process from 'node:process';

const __dirname = dirname(fileURLToPath(import.meta.url));

async function main() {
  // First run TypeScript to generate declaration files
  console.log('Running TypeScript compiler...');
  try {
    execSync('pnpm exec tsc', { stdio: 'inherit', cwd: __dirname });
  } catch (error) {
    console.error('TypeScript compilation failed', error);
    process.exit(1);
  }

  // Find all TypeScript files
  const entryPoints = await glob(path.join(process.cwd(), './ts/**/*.ts'), {
    ignore: ['node_modules/**', 'public/**', '**/*.d.ts', 'build.js'],
    cwd: __dirname,
  });

  // Build with esbuild
  console.log(`Building with esbuild: ${JSON.stringify(entryPoints)}`);
  await build({
    entryPoints,
    outdir: 'public/js',
    outbase: './ts',
    bundle: false,
    platform: 'node',
    format: 'esm',
    target: 'es2020',
    sourcemap: true,
    outExtension: { '.js': '.js' },
  });

  // Fix imports in the generated JS files to include .js extensions
  console.log('Fixing import extensions...');
  await fixImportExtensions();

  console.log('Build completed successfully!');
}

async function fixImportExtensions() {
  const jsFiles = await glob('public/**/*.js', { cwd: __dirname });

  for (const file of jsFiles) {
    const filePath = path.join(__dirname, file);
    let content = fs.readFileSync(filePath, 'utf8');

    // Replace imports without extensions
    content = content.replace(
      /from\s+['"]([^'"]*?)['"];/g,
      (match, importPath) => {
        // Skip external modules
        if (importPath.startsWith('.')) {
          // Add .js extension if it doesn't have one
          if (!importPath.endsWith('.js')) {
            return `from '${importPath}.js';`;
          }
        }
        return match;
      },
    );

    fs.writeFileSync(filePath, content);
  }
}

main().catch((err) => {
  console.error('Build failed:', err);
  process.exit(1);
});
]697;OSCUnlock=f0b407a1d40d4101ba696cdb2b1ae760]697;Dir=/Users/lschiere/src/schierer/Game-EvonyTKR/share]697;Shell=bash]697;ShellPath=/bin/bash]697;PID=19401]697;ExitCode=0]697;TTY=/dev/ttys018]697;Log=]697;User=lschiere]697;OSCLock=f0b407a1d40d4101ba696cdb2b1ae760]697;PreExec]697;StartPrompt]0;lschiere@80a997121f31: ~/src/schierer/Game-EvonyTKR/sharelschiere@80a997121f31:~/src/schierer/Game-EvonyTKR/share$ ]697;EndPrompt]697;NewCmd=f0b407a1d40d4101ba696cdb2b1ae760ls -R public/js/
Generals			ts				tsconfig.build.tsbuildinfo	tsconfig.tsbuildinfo

public/js/Generals:
Pairs

public/js/Generals/Pairs:
typeIndex.js		typeIndex.js.map

public/js/ts:
Generals

public/js/ts/Generals:
Pairs

public/js/ts/Generals/Pairs:
typeIndex.d.ts		typeIndex.d.ts.map	typeIndex.js
]697;OSCUnlock=f0b407a1d40d4101ba696cdb2b1ae760]697;Dir=/Users/lschiere/src/schierer/Game-EvonyTKR/share]697;Shell=bash]697;ShellPath=/bin/bash]697;PID=19401]697;ExitCode=0]697;TTY=/dev/ttys018]697;Log=]697;User=lschiere]697;OSCLock=f0b407a1d40d4101ba696cdb2b1ae760]697;PreExec]697;StartPrompt]0;lschiere@80a997121f31: ~/src/schierer/Game-EvonyTKR/sharelschiere@80a997121f31:~/src/schierer/Game-EvonyTKR/share$ ]697;EndPrompt]697;NewCmd=f0b407a1d40d4101ba696cdb2b1ae760exit

Script done on Mon Jun 16 17:44:13 2025
